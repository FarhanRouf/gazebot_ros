name: CI (ROS 2 build & test)
on:
  push: { branches: [ main ] }
  pull_request:

jobs:
  build-test:
    runs-on: ubuntu-latest
    container:
      image: rostooling/setup-ros-docker:ubuntu-noble-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build & Test (ROS 2 Jazzy)
        uses: ros-tooling/action-ros-ci@v0.4
        with:
          target-ros2-distro: jazzy
          package-name: gazebot_ros
          colcon-defaults: |
            { "build": { "symlink-install": true } }
      - name: Upload colcon logs on failure
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: colcon-logs
          path: ${{ steps.build-test.outputs.ros-workspace-directory-name }}/log
